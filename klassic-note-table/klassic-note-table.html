<!DOCTYPE html>
<html lang="en-SG">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href='https://fonts.googleapis.com/css?family=Open Sans' rel='stylesheet'/>
	<script src="p5.js"></script>
    <title>Klassic Note Table</title>
</head>
<style>
html {
  font-family: Open Sans;
  font-size: 12px;
  margin: auto;
}
.table-filter {
  padding: 2px;
}
</style>
<body>
    <h1>Klassic Note Table</h1>
    <p><a href="../index.html">Back</a></p>
	<div class="table-filter">
		<input id="dbInputSongTitle" type="text" placeholder="Song Title" title="search"/>
		<input id="dbSubmitSongTitle" type="submit" onclick="searchFunction('dbInputSongTitle')" placeholder="submit" value="Submit"/>
	</div>
	<div class="table-filter">
		<input id="dbInputArtistTitle" type="text" placeholder="Artist Title" title="search"/>
		<input id="dbSubmitArtistTitle" type="submit" onclick="searchFunction('dbInputArtistTitle')" placeholder="submit" value="Submit"/>
	</div>
	<br>
	<div id="table-sort-module">
		<div id="table-result"></div>
		<div id="table-box">
			<table id="dbTable">
				<!-- <tr class="header">
					<th style="width:auto;">Title</th>
					<th style="width:auto;">Artist</th>
					<th style="width:auto;">Commisioner</th>
					<th style="width:auto;">Completed</th>
				</tr>
				<tr>
					<td>The Annunciation</td>
					<td>Fra Angelico</td>
					<td>Cosimo de' Medici</td>
					<td>1446</td>
				</tr>
				<tr>
					<td>The Klassic</td>
					<td>The Angelica</td>
					<td>Cosimo Merci</td>
					<td>1448</td>
				</tr> -->
			</table>
		</div>
	</div>
</body>
<script>
document.getElementById('dbInputSongTitle').addEventListener("keyup", function(event) {
  // Number 13 is the "Enter" key on the keyboard
  if (event.keyCode === 13) {
    // Cancel the default action, if needed
    event.preventDefault();
    // Trigger the button element with a click
    document.getElementById("dbSubmitSongTitle").click(this);
  }
});
document.getElementById('dbInputArtistTitle').addEventListener("keyup", function(event) {
  // Number 13 is the "Enter" key on the keyboard
  if (event.keyCode === 13) {
    // Cancel the default action, if needed
    event.preventDefault();
    // Trigger the button element with a click
    document.getElementById("dbSubmitArtistTitle").click(this);
  }
});
function searchFunction(item) {
	let counter = 0;
	// Declare starting variables 
	let filter = document.getElementById(item).value.toUpperCase().trim();
	let table = document.getElementById("dbTable");
	if(table.tBodies[0] == undefined) return;
	let trs = table.tBodies[0].getElementsByTagName("tr");
	// Clear inputs
	for (let input of document.getElementsByTagName("input")) { if(input.title == "search") input.value = ""; }
	// Loop through rows
	for (let i = 1; i < trs.length; i++) {
		// Define the cells
		let tds = trs[i].getElementsByTagName("td");
		if(filter == "") trs[i].style.display = "";
		// hide the row
		else trs[i].style.display = "none";
		// loop through cell columns
		for (let i2 = 0; i2 < tds.length; i2++) {
			// if there's a match AND based on 
			//if (tds[i2].innerHTML.toUpperCase().indexOf(filter) > -1) { // unhide the row
			if (tds[i2].innerHTML.toUpperCase().includes(filter)) { // unhide the row
				if(item == "dbInputSongTitle" && i2 == 6) { trs[i].style.display = ""; counter++; }
				if(item == "dbInputArtistTitle" && i2 == 7) { trs[i].style.display = ""; counter++; }
				// skip to the next row
				continue;
			}
		}
	}
	document.getElementById("table-result").innerText = counter + " results found";
}

//-- p5.js EXAMPLE --//
// Given the following CSV file called "klassic-note-database-song-table.csv"
// located in the project's root folder

let table;

function loadTableFromCSV() {
  button.hide();
  document.getElementById("table-result").innerText = "Loading...";
  //my table is comma separated value "csv"
  //and has a header specifying the columns labels
  table = loadTable('https://knneo.github.io/klassic-note-table/klassic-note-database-song-table.csv', 'csv', displayTable);
  //the file can be remote
  //table = loadTable("http://p5js.org/reference/assets/mammals.csv",
  //                  "csv", "header");
}

function displayTable() {
  if(table.getRowCount() == 0) button.show();
  //count the columns
  //print(table.getRowCount() + ' total rows in table');
  //print(table.getColumnCount() + ' total columns in table');
  document.getElementById("table-result").innerText = (table.getRowCount() - 1) + " results found";

  //cycle through the table
  let tableArray = table.getArray();
  let tableHTML;
  for (let i = 0; i < tableArray.length; i++) {
    if(i > 0) {
	tableHTML += '<tr>';
	for(let j = 0; j < tableArray[i].length; j++) {
	tableHTML += '<td nowrap>' + (tableArray[i][j].includes('http') ? '<a href="' + tableArray[i][j] + '" target="_blank">Link</a>' : tableArray[i][j]) + '</td>';
	}
	tableHTML += '</tr>';
	continue;
	}
	//header
	tableHTML = '<tr class="header">';
	for(let j = 0; j < tableArray[i].length; j++) {
	tableHTML += '<th>' + tableArray[i][j] + '</th>';
	}
	tableHTML += '</tr>';
  }
  //assign
  document.getElementById("dbTable").innerHTML = tableHTML;
  //disable input until load complete
}

function setup() {
  //button to load table
  button = createButton('Load Table');
  button.mousePressed(loadTableFromCSV);
}
</script>
</html>
